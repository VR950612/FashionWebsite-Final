<div id="delete_product_model_{{ product.id }}" class="modal">
  <span
    onclick="document.getElementById('delete_product_model_{{ product.id }}').style.display='none'"
    class="close"
    title="Close Modal"
    >Ã—</span
  >
  <form
    id="delete_product_form_{{ product.id }}"
    class="modal-content"
    action="{{ url_for('merchant_deleteproduct', product_id=product.id) }}"
    <!--
    Set
    the
    action
    URL
    --
  >
    method="POST"
    <!-- Use POST method -->
    >
    <div
      class="container"
      style="
        background-color: #ffffff;
        margin-top: 10%;
        margin-left: 30%;
        margin-right: 30%;
      "
    >
      <h1>Delete Product</h1>
      <h4>Are you sure you want to delete this product?</h4>
      <div class="clearfix">
        <!-- Close the delete modal if we click the cancel button -->
        <button
          type="button"
          onclick="document.getElementById('delete_product_model_{{ product.id }}').style.display='none'"
          class="cancelbtn btn-info btn-md"
        >
          Cancel
        </button>
        <!-- Submit button for deletion -->
        <input
          type="submit"
          class="deletebtn btn-danger btn-md"
          value="Delete"
        />
      </div>
    </div>
  </form>
  <div class="success-msg" id="success-output-msg-{{ product.id }}"></div>
  <div class="failure-msg" id="failure-output-msg-{{ product.id }}"></div>
</div>

<script>
  // Get the modal
  var modal = document.getElementById("delete_product_model_{{ product.id }}");

  // When the user clicks anywhere outside of the modal, close it
  window.onclick = function (event) {
    if (event.target == modal) {
      modal.style.display = "none";
    }
  };
</script>
<script>
  $(document).ready(function () {
    $("#delete_product_form_{{ product.id }}").on("submit", function (e) {
      e.preventDefault(); // Prevent default form submission

      $.ajax({
        type: "POST",
        url: $(this).attr("action"), // Use the form's action attribute
        data: {
          message: "Delete this product!",
        },
        success: function (data) {
          // Hide previous messages
          $(".success-msg, .failure-msg").hide();

          if (data.success) {
            $("#success-output-msg-{{ product.id }}")
              .text(data.output_msg)
              .fadeIn() // Use fadeIn for smoother appearance
              .delay(3000) // Show for 3 seconds
              .fadeOut(); // Fade out after 3 seconds
            setTimeout(function () {
              window.location.href =
                "/merchant_viewproducts/{{product.product_category}}"; // Redirect to the product list (adjust as necessary)
            }, 3000); // Redirect after 3 seconds
          } else {
            $("#failure-output-msg-{{ product.id }}")
              .text(data.output_msg)
              .fadeIn()
              .delay(3000) // Show for 3 seconds
              .fadeOut(); // Fade out after 3 seconds
          }
        },
        error: function () {
          $("#failure-output-msg-{{ product.id }}")
            .text("An error occurred. Please try again.")
            .fadeIn()
            .delay(3000) // Show for 3 seconds
            .fadeOut(); // Fade out after 3 seconds
        },
      });
    });
  });
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
